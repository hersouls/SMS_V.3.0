import{j as e}from"./radix-PkTNM-lE.js";import{r as s}from"./vendor-CzXpEsbX.js";import{s as t}from"./index-tT6ahxMo.js";import{am as r,a6 as a,aA as l,U as i,C as n,k as c,ag as o,a as d,an as u}from"./icons-ojVkv7w_.js";import"./router-Cv8QkTiH.js";import"./others-B6ceBAQi.js";import"./utils-VH1XAVo5.js";const m=async()=>{try{const{data:{session:e},error:s}=await t.auth.getSession();if(s)return{isAuthenticated:!1,error:s.message,sessionData:null};if(null==e?void 0:e.user){const s=Math.floor(Date.now()/1e3),t=!!e.expires_at&&s>=e.expires_at;return{isAuthenticated:!t,error:null,sessionData:{isAuthenticated:!t,userId:e.user.id,email:e.user.email,role:e.user.role||"authenticated",expiresAt:e.expires_at,isExpired:t,accessToken:e.access_token}}}return{isAuthenticated:!1,error:null,sessionData:null}}catch(e){return{isAuthenticated:!1,error:e instanceof Error?e.message:"Unknown error",sessionData:null}}},h=()=>{const[h,x]=s.useState(null),[g,p]=s.useState([]),[j,b]=s.useState(!1),[w,f]=s.useState(!1),[y,N]=s.useState(null),v=async()=>{var e;try{const s=await m();s.sessionData?x({isAuthenticated:s.isAuthenticated,userId:s.sessionData.userId,email:s.sessionData.email,role:s.sessionData.role,expiresAt:s.sessionData.expiresAt,accessToken:(null==(e=s.sessionData.accessToken)?void 0:e.substring(0,20))+"..."}):x({isAuthenticated:!1})}catch(s){x({isAuthenticated:!1})}};s.useEffect(()=>{v()},[]);const S=(e,s)=>e?"Success":(null==s?void 0:s.includes("Row Level Security policy"))?"RLS Policy Block (Expected for unauthenticated users)":"Failed";return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[e.jsx(r,{className:"w-8 h-8 mr-3 text-blue-600"}),"RLS (Row Level Security) ë””ë²„ê±°"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:async()=>{await(async()=>{try{const{data:{session:e},error:s}=await t.auth.getSession();if(s)return;if(!e)return;const r=Math.floor(Date.now()/1e3),a=e.expires_at,l=a?a-r:0;!(a&&r>=a)&&l>0&&(Math.floor(l/3600),Math.floor(l%3600/60)),e.user.user_metadata&&Object.keys(e.user.user_metadata).length}catch(e){}})(),alert("ì„¸ì…˜ ìƒì„¸ ì •ë³´ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê°œë°œì ë„êµ¬(F12)ì˜ ì½˜ì†” íƒ­ì„ í™•ì¸í•˜ì„¸ìš”.")},className:"flex items-center px-3 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:[e.jsx(a,{className:"w-4 h-4 mr-1"}),"ì„¸ì…˜ ìƒì„¸"]}),e.jsxs("button",{onClick:async()=>{f(!0);try{const{data:e,error:s}=await t.auth.refreshSession();s||await v()}catch(e){}finally{f(!1)}},disabled:w,className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(l,{className:"w-4 h-4 mr-1 "+(w?"animate-spin":"")}),"ìƒˆë¡œê³ ì¹¨"]}),e.jsxs("button",{onClick:v,className:"flex items-center px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(i,{className:"w-4 h-4 mr-1"}),"ì¸ì¦ í™•ì¸"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center",children:[e.jsx(i,{className:"w-5 h-5 mr-2"}),"ì¸ì¦ ìƒíƒœ"]}),h?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center",children:[h.isAuthenticated?e.jsx(n,{className:"w-5 h-5 text-green-500 mr-2"}):e.jsx(c,{className:"w-5 h-5 text-red-500 mr-2"}),e.jsx("span",{className:"font-medium",children:h.isAuthenticated?"ë¡œê·¸ì¸ë¨":"ë¡œê·¸ì•„ì›ƒë¨"})]}),h.isAuthenticated&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"ì‚¬ìš©ì ID:"})," ",h.userId]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ì´ë©”ì¼:"})," ",h.email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ì—­í• :"})," ",h.role]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ë§Œë£Œ ì‹œê°„:"})," ",h.expiresAt?new Date(1e3*h.expiresAt).toLocaleString():"N/A"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"ì•¡ì„¸ìŠ¤ í† í°:"}),e.jsx("code",{className:"ml-2 text-sm bg-gray-200 px-2 py-1 rounded",children:h.accessToken})]})]})]}):e.jsx("div",{className:"text-gray-500",children:"ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ì¤‘..."})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[e.jsx(o,{className:"w-5 h-5 mr-2"}),"RLS ì •ì±… í…ŒìŠ¤íŠ¸"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:async()=>{b(!0);try{const e=await(async()=>{const e=await m();if(!e.isAuthenticated)return{success:!1,message:"ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.",authStatus:e};const s=[];try{const{data:e,error:r}=await t.from("subscriptions").select("*").limit(5);r?s.push({table:"subscriptions",success:!1,error:r.message,rowCount:0}):s.push({table:"subscriptions",success:!0,error:null,rowCount:(null==e?void 0:e.length)||0})}catch(a){s.push({table:"subscriptions",success:!1,error:a instanceof Error?a.message:"Unknown error",rowCount:0})}try{const{data:e,error:r}=await t.from("user_settings").select("*").limit(5);r?s.push({table:"user_settings",success:!1,error:r.message,rowCount:0}):s.push({table:"user_settings",success:!0,error:null,rowCount:(null==e?void 0:e.length)||0})}catch(a){s.push({table:"user_settings",success:!1,error:a instanceof Error?a.message:"Unknown error",rowCount:0})}try{const{data:e,error:r}=await t.from("notifications").select("*").limit(5);r?s.push({table:"notifications",success:!1,error:r.message,rowCount:0}):s.push({table:"notifications",success:!0,error:null,rowCount:(null==e?void 0:e.length)||0})}catch(a){s.push({table:"notifications",success:!1,error:a instanceof Error?a.message:"Unknown error",rowCount:0})}const r=s.filter(e=>e.success).length;return{success:r>0,message:`${r}/${s.length} í…Œì´ë¸”ì— ì„±ê³µì ìœ¼ë¡œ ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤.`,authStatus:e,results:s}})();if(N(e),e.results){const s=e.results.map(e=>({table:e.table,operation:"SELECT",success:e.success,error:e.error,rowCount:e.rowCount}));p(s)}}catch(e){}finally{b(!1)}},disabled:j,className:"flex items-center px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),j?"í…ŒìŠ¤íŠ¸ ì¤‘...":"ë¡œê·¸ì¸ í›„ í…ŒìŠ¤íŠ¸"]}),e.jsxs("button",{onClick:async()=>{b(!0);try{const e=await(async()=>{var e;const s=await m(),r=["subscriptions","user_settings","notifications","user_behavior_analytics"],a=[];for(const i of r)try{const{data:r,error:l}=await t.from(i).select("*").limit(1),n={table:i,isAuthenticated:s.isAuthenticated,success:!l,error:null==l?void 0:l.message,rowCount:(null==r?void 0:r.length)||0,rlsBlocked:(null==(e=null==l?void 0:l.message)?void 0:e.includes("Row Level Security policy"))||!1};l&&l.message.includes("Row Level Security policy"),a.push(n)}catch(l){a.push({table:i,isAuthenticated:s.isAuthenticated,success:!1,error:l instanceof Error?l.message:"Unknown error",rowCount:0,rlsBlocked:!1})}return{authStatus:s,results:a,summary:{total:a.length,successful:a.filter(e=>e.success).length,rlsBlocked:a.filter(e=>e.rlsBlocked).length,errors:a.filter(e=>!e.success&&!e.rlsBlocked).length}}})(),s=e.results.map(e=>({table:e.table,operation:"SELECT",success:e.success,error:e.error,rowCount:e.rowCount}));p(s),N(e)}catch(e){}finally{b(!1)}},disabled:j,className:"flex items-center px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),j?"í…ŒìŠ¤íŠ¸ ì¤‘...":"RLS ì •ì±… í…ŒìŠ¤íŠ¸"]})]})]}),y&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½"}),e.jsx("p",{className:"text-sm text-blue-700",children:y.message}),y.summary&&e.jsxs("div",{className:"mt-2 text-sm text-blue-600",children:["ì´ ",y.summary.total,"ê°œ í…Œì´ë¸” | ì„±ê³µ: ",y.summary.successful,"ê°œ | RLS ì°¨ë‹¨: ",y.summary.rlsBlocked,"ê°œ | ì˜¤ë¥˜: ",y.summary.errors,"ê°œ"]})]}),g.length>0&&e.jsx("div",{className:"space-y-3",children:g.map((s,t)=>{return e.jsxs("div",{className:"bg-white rounded-lg p-4 border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[(a=s.success,l=s.error,a?e.jsx(n,{className:"w-5 h-5 text-green-500"}):(null==l?void 0:l.includes("Row Level Security policy"))?e.jsx(r,{className:"w-5 h-5 text-orange-500"}):e.jsx(c,{className:"w-5 h-5 text-red-500"})),e.jsxs("span",{className:"ml-2 font-medium",children:[s.table,".",s.operation]})]}),e.jsx("span",{className:"text-sm text-gray-600",children:S(s.success,s.error)})]}),void 0!==s.rowCount&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["ì¡°íšŒëœ í–‰ ìˆ˜: ",s.rowCount]}),s.error&&e.jsxs("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:[e.jsx("strong",{children:"ì˜¤ë¥˜:"})," ",s.error]})]},t);var a,l})}),0===g.length&&!j&&e.jsx("div",{className:"text-center text-gray-500 py-8",children:"í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ RLS ì •ì±…ì„ í™•ì¸í•˜ì„¸ìš”."})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(u,{className:"w-5 h-5 mr-2 text-orange-500"}),"RLS ì •ì±… ì´í•´í•˜ê¸°"]}),e.jsxs("div",{className:"space-y-4 text-sm text-gray-700",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"âœ… ì •ìƒì ì¸ RLS ë™ì‘"}),e.jsxs("p",{children:['ë¯¸ì¸ì¦ ì‚¬ìš©ìê°€ ë°ì´í„°ì— ì ‘ê·¼í•  ë•Œ "Row Level Security policy" ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì€',e.jsx("strong",{children:" ì •ìƒì ì¸ ë³´ì•ˆ ì„¤ì •"}),"ì…ë‹ˆë‹¤. ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ê°€ ì˜¬ë°”ë¥´ê²Œ ë³´í˜¸ë˜ê³  ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤."]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-800 mb-2",children:"ğŸ” í•´ê²° ë°©ë²•"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•œ í›„ ë°ì´í„°ì— ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤."}),e.jsx("li",{children:"ë¡œê·¸ì¸ í˜ì´ì§€(/login)ì—ì„œ ì¸ì¦ì„ ì™„ë£Œí•˜ì„¸ìš”."}),e.jsx("li",{children:"ì¸ì¦ í›„ ì´ í˜ì´ì§€ë¥¼ ë‹¤ì‹œ ë°©ë¬¸í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”."})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-yellow-800 mb-2",children:"ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'ë¨¼ì € "ì¸ì¦ í™•ì¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í˜„ì¬ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.'}),e.jsx("li",{children:"ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¼ë©´ /login í˜ì´ì§€ì—ì„œ ë¡œê·¸ì¸í•˜ì„¸ìš”."}),e.jsx("li",{children:'ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì´ í˜ì´ì§€ë¡œ ëŒì•„ì™€ì„œ "ë¡œê·¸ì¸ í›„ í…ŒìŠ¤íŠ¸"ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.'}),e.jsx("li",{children:"ì¸ì¦ëœ ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤."}),e.jsx("li",{children:'"ì„¸ì…˜ ìƒì„¸" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì½˜ì†”ì—ì„œ ë” ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'})]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-800 mb-2",children:"ğŸ¯ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸"}),e.jsx("p",{className:"mb-2",children:"ë‹¤ìŒ ì½”ë“œë¥¼ ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì§ì ‘ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:"}),e.jsx("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:"// ì¸ì¦ ìƒíƒœ í™•ì¸\nconst { data: { session } } = await supabase.auth.getSession();\nconsole.log('ì„¸ì…˜ ìƒíƒœ:', session ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì•„ì›ƒë¨');"})]})]})]})]})})};export{h as RLSDebugger};
