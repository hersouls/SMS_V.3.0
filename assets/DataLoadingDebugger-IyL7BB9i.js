import{j as e}from"./radix-PkTNM-lE.js";import{r as s}from"./vendor-CzXpEsbX.js";import{u as r,s as t,l as i}from"./index-tT6ahxMo.js";import"./router-Cv8QkTiH.js";import"./others-B6ceBAQi.js";import"./utils-VH1XAVo5.js";import"./icons-ojVkv7w_.js";const a=()=>{const[a,o]=s.useState({}),[n,c]=s.useState(!1),{user:l}=r();return l?e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"데이터 로딩 디버거"}),e.jsx("button",{onClick:async()=>{var e,s,r;c(!0);const a={timestamp:(new Date).toISOString(),userInfo:{},authStatus:{},directSupabaseQuery:{},apiServiceQuery:{},errors:[]};try{a.userInfo={user:l,hasUser:!!l,userId:null==l?void 0:l.id};const{data:{session:o},error:c}=await t.auth.getSession();a.authStatus={hasSession:!!o,sessionError:null==c?void 0:c.message,userId:null==(e=null==o?void 0:o.user)?void 0:e.id,accessToken:(null==o?void 0:o.access_token)?"present":"missing",expiresAt:null==o?void 0:o.expires_at,currentTime:Math.floor(Date.now()/1e3)};try{const{data:e,error:s}=await t.from("subscriptions").select("*").limit(5);a.directSupabaseQuery={success:!s,error:null==s?void 0:s.message,dataCount:(null==e?void 0:e.length)||0,firstItem:(null==e?void 0:e[0])?{id:e[0].id,service_name:e[0].service_name,user_id:e[0].user_id}:null}}catch(n){a.directSupabaseQuery={success:!1,error:n.message},a.errors.push(`Direct Supabase query failed: ${n.message}`)}try{const e=await i.getSubscriptions();a.apiServiceQuery={success:!0,dataCount:(null==(s=e.subscriptions)?void 0:s.length)||0,firstItem:(null==(r=e.subscriptions)?void 0:r[0])?{id:e.subscriptions[0].id,serviceName:e.subscriptions[0].serviceName,amount:e.subscriptions[0].amount}:null}}catch(n){a.apiServiceQuery={success:!1,error:n.message},a.errors.push(`API service query failed: ${n.message}`)}try{(null==o?void 0:o.access_token)?(i.setAccessToken(o.access_token),a.accessTokenSet=!0):(a.accessTokenSet=!1,a.errors.push("No access token available"))}catch(n){a.errors.push(`Access token setting failed: ${n.message}`)}}catch(n){a.errors.push(`General error: ${n.message}`)}o(a),c(!1)},disabled:n,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:n?"디버깅 중...":"디버그 테스트 실행"}),Object.keys(a).length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"디버그 결과:"}),e.jsx("pre",{className:"bg-gray-100 p-4 rounded text-sm overflow-auto max-h-96 whitespace-pre-wrap",children:JSON.stringify(a,null,2)}),a.errors&&a.errors.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-red-100 border border-red-400 rounded",children:[e.jsx("h4",{className:"font-semibold text-red-800",children:"발견된 오류:"}),e.jsx("ul",{className:"list-disc list-inside text-red-700",children:a.errors.map((s,r)=>e.jsx("li",{children:s},r))})]}),a.errors&&0===a.errors.length&&e.jsx("div",{className:"mt-4 p-4 bg-green-100 border border-green-400 rounded",children:e.jsx("p",{className:"text-green-700",children:"모든 테스트가 성공했습니다!"})})]})]}):e.jsx("div",{className:"p-4 bg-yellow-100 border border-yellow-400 rounded",children:e.jsx("p",{children:"사용자가 로그인되지 않았습니다. 먼저 로그인해주세요."})})};export{a as DataLoadingDebugger};
