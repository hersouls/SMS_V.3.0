# 커스텀 도메인 (sub.moonwave.kr) 배포 가이드

SMS V.3.0을 커스텀 도메인 `sub.moonwave.kr`에 배포하기 위한 단계별 가이드입니다.

## 🌐 도메인 설정

### 1. DNS 설정 (중요!)

도메인 관리 업체(예: Cloudflare, Route53, Namecheap 등)에서 다음 DNS 레코드를 설정하세요:

#### CNAME 레코드 설정
```
Type: CNAME
Name: sub
Value: hersouls.github.io
TTL: Auto 또는 300
```

#### 또는 A 레코드 설정 (대안)
```
Type: A
Name: sub
Value: 185.199.108.153
       185.199.109.153
       185.199.110.153
       185.199.111.153
TTL: Auto 또는 300
```

### 2. GitHub Pages 커스텀 도메인 설정

1. GitHub 리포지토리 → **Settings** → **Pages**
2. Custom domain에 `sub.moonwave.kr` 입력
3. **Enforce HTTPS** 체크박스 활성화 (SSL 인증서 자동 발급)

## 🚀 자동 배포 설정

### 1. GitHub Secrets 설정

GitHub 리포지토리 Settings → Secrets and variables → Actions에서 다음 환경 변수를 추가하세요:

```
VITE_SUPABASE_URL=https://bfurhjgnnjgfcafdrotk.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJmdXJoamdubmpnZmNhZmRyb3RrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MDQ4NTIsImV4cCI6MjA2OTE4MDg1Mn0.mxP7V92XRdY8e_7r9GR3B04blukhVf1vu_teRguv20U
VITE_GOOGLE_CLIENT_ID=350164367455-h4c615pr0eqoaj218bi6stlvpiqab45k.apps.googleusercontent.com
```

### 2. 자동 배포 실행

- `main` 브랜치에 코드를 푸시하면 자동으로 배포됩니다
- GitHub Actions 탭에서 배포 진행 상황을 확인할 수 있습니다

## 📍 배포 URL

배포 완료 후 다음 URL에서 애플리케이션에 접근할 수 있습니다:

- **Production URL**: `https://sub.moonwave.kr`
- **Alternative URL**: `https://www.sub.moonwave.kr` (선택사항)

## 🔐 백엔드 서비스 설정

### Supabase 설정 업데이트

1. Supabase Dashboard → Authentication → URL Configuration에서 다음 URL들을 추가:
   ```
   Site URL: https://sub.moonwave.kr
   Redirect URLs:
   - https://sub.moonwave.kr
   - https://sub.moonwave.kr/dashboard
   - https://www.sub.moonwave.kr (www 서브도메인 사용 시)
   - https://www.sub.moonwave.kr/dashboard
   ```

2. CORS 설정 확인:
   - Edge Functions에서 `https://sub.moonwave.kr` 허용 확인

### Google OAuth 설정 업데이트

1. Google Cloud Console → APIs & Services → Credentials
2. OAuth 2.0 Client IDs에서 승인된 리다이렉트 URI에 추가:
   ```
   https://sub.moonwave.kr/dashboard
   https://www.sub.moonwave.kr/dashboard
   https://bfurhjgnnjgfcafdrotk.supabase.co/auth/v1/callback
   ```

3. 승인된 JavaScript 원본에 추가:
   ```
   https://sub.moonwave.kr
   https://www.sub.moonwave.kr
   ```

## 🛠️ 기술적 변경 사항

### 1. CNAME 파일 추가
```
public/CNAME
```
파일에 도메인 설정

### 2. Router 설정
- `HashRouter`에서 `BrowserRouter`로 복원
- 커스텀 도메인에서는 BrowserRouter 사용 가능

### 3. Base Path 제거
```typescript
// vite.config.ts에서 base 설정 제거
// 커스텀 도메인에서는 root path 사용
```

### 4. 환경 변수 업데이트
```yaml
# .github/workflows/deploy.yml
VITE_APP_URL: https://sub.moonwave.kr
VITE_ALLOWED_ORIGINS: https://sub.moonwave.kr,https://www.sub.moonwave.kr
```

## 🚨 문제 해결

### DNS 전파 대기
- DNS 변경 후 최대 24-48시간 소요될 수 있습니다
- `nslookup sub.moonwave.kr` 명령어로 DNS 전파 상태 확인

### SSL 인증서 발급 대기
- GitHub Pages에서 자동으로 Let's Encrypt 인증서 발급
- 보통 몇 분 내에 완료되지만 최대 24시간 소요 가능

### 404 오류 발생 시
1. DNS 설정이 올바른지 확인
2. CNAME 파일이 정확히 배포되었는지 확인
3. GitHub Pages 설정에서 커스텀 도메인이 올바르게 설정되었는지 확인

### OAuth 오류 시
1. 모든 백엔드 서비스에서 새로운 도메인이 허용되었는지 확인
2. 브라우저 캐시 및 쿠키 삭제 후 재시도

## 📝 추가 설정 (선택사항)

### www 서브도메인 리다이렉트
`www.sub.moonwave.kr`에서 `sub.moonwave.kr`로 리다이렉트하려면:

1. DNS에 www CNAME 레코드 추가:
   ```
   Type: CNAME
   Name: www.sub
   Value: sub.moonwave.kr
   ```

2. GitHub Pages에서 자동으로 리다이렉트 처리됩니다

### CDN 설정 (성능 향상)
Cloudflare 등의 CDN을 사용하는 경우:
1. DNS는 CDN을 통해 관리
2. CDN에서 GitHub Pages로 프록시 설정
3. 캐싱 규칙 설정으로 성능 향상

## 🔄 배포 프로세스

1. 코드 변경 후 `main` 브랜치에 푸시
2. GitHub Actions 자동 실행
3. 빌드 완료 후 `sub.moonwave.kr`에 자동 배포
4. SSL 인증서 자동 갱신

## 📊 모니터링

### 도메인 상태 확인 도구
- `dig sub.moonwave.kr` - DNS 확인
- `curl -I https://sub.moonwave.kr` - HTTP 상태 확인
- [SSL Labs](https://www.ssllabs.com/ssltest/) - SSL 인증서 확인

---

배포 과정에서 문제가 발생하면 GitHub Issues에 문의해 주세요.