# SMS V.3.0 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

## ğŸ“‹ ê°œìš”

**í”„ë¡œì íŠ¸**: SMS V.3.0  
**ë°ì´í„°ë² ì´ìŠ¤**: Supabase PostgreSQL  
**ìƒíƒœ**: âœ… ì™„ë£Œ  

---

## ğŸ—„ï¸ í…Œì´ë¸” êµ¬ì¡°

### 1. subscriptions (êµ¬ë… ì„œë¹„ìŠ¤)

êµ¬ë… ì„œë¹„ìŠ¤ì˜ í•µì‹¬ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ë©”ì¸ í…Œì´ë¸”ì…ë‹ˆë‹¤.

```sql
CREATE TABLE public.subscriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  service_name text NOT NULL,
  service_url text,
  service_image_url text,
  category ARRAY,
  status text DEFAULT 'active'::text CHECK (status = ANY (ARRAY['active'::text, 'paused'::text, 'canceled'::text])),
  amount numeric NOT NULL,
  currency text DEFAULT 'KRW'::text CHECK (currency = ANY (ARRAY['KRW'::text, 'USD'::text])),
  payment_cycle text DEFAULT 'monthly'::text CHECK (payment_cycle = ANY (ARRAY['monthly'::text, 'yearly'::text, 'once'::text])),
  payment_day integer CHECK (payment_day >= 1 AND payment_day <= 31),
  payment_method text,
  start_date date,
  end_date date,
  auto_renewal boolean DEFAULT true,
  alarm_days ARRAY,
  tier text,
  benefits text,
  tags ARRAY,
  memo text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT subscriptions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
```

#### ì£¼ìš” í•„ë“œ ì„¤ëª…

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
|--------|------|------|----------|
| `id` | uuid | ê³ ìœ  ì‹ë³„ì | PRIMARY KEY |
| `user_id` | uuid | ì‚¬ìš©ì ID | FOREIGN KEY (auth.users) |
| `service_name` | text | ì„œë¹„ìŠ¤ ì´ë¦„ | NOT NULL |
| `service_url` | text | ì„œë¹„ìŠ¤ URL | - |
| `service_image_url` | text | ì„œë¹„ìŠ¤ ë¡œê³  ì´ë¯¸ì§€ URL | - |
| `category` | ARRAY | ì¹´í…Œê³ ë¦¬ ë°°ì—´ | - |
| `status` | text | ìƒíƒœ (active/paused/canceled) | DEFAULT 'active' |
| `amount` | numeric | êµ¬ë…ë£Œ | NOT NULL |
| `currency` | text | í†µí™” (KRW/USD) | DEFAULT 'KRW' |
| `payment_cycle` | text | ê²°ì œ ì£¼ê¸° (monthly/yearly/once) | DEFAULT 'monthly' |
| `payment_day` | integer | ê²°ì œì¼ (1-31) | 1 â‰¤ payment_day â‰¤ 31 |
| `payment_method` | text | ê²°ì œ ë°©ë²• | - |
| `start_date` | date | êµ¬ë… ì‹œì‘ì¼ | - |
| `end_date` | date | êµ¬ë… ì¢…ë£Œì¼ | - |
| `auto_renewal` | boolean | ìë™ ê°±ì‹  ì—¬ë¶€ | DEFAULT true |
| `alarm_days` | ARRAY | ì•Œë¦¼ ì„¤ì •ì¼ ë°°ì—´ | - |
| `tier` | text | êµ¬ë… í‹°ì–´ | - |
| `benefits` | text | í˜œíƒ ì„¤ëª… | - |
| `tags` | ARRAY | íƒœê·¸ ë°°ì—´ | - |
| `memo` | text | ë©”ëª¨ | - |

---

### 2. exchange_rates (í™˜ìœ¨ ì •ë³´)

ì‚¬ìš©ìë³„ í™˜ìœ¨ ì„¤ì •ì„ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

```sql
CREATE TABLE public.exchange_rates (
  user_id uuid NOT NULL,
  usd_krw numeric DEFAULT 1300,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT exchange_rates_pkey PRIMARY KEY (user_id),
  CONSTRAINT exchange_rates_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
```

#### ì£¼ìš” í•„ë“œ ì„¤ëª…

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
|--------|------|------|----------|
| `user_id` | uuid | ì‚¬ìš©ì ID | PRIMARY KEY, FOREIGN KEY |
| `usd_krw` | numeric | USD/KRW í™˜ìœ¨ | DEFAULT 1300 |
| `updated_at` | timestamp | ì—…ë°ì´íŠ¸ ì‹œê°„ | DEFAULT now() |

---

### 3. subscription_alarms (êµ¬ë… ì•Œë¦¼)

êµ¬ë… ê´€ë ¨ ì•Œë¦¼ ì„¤ì •ì„ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

```sql
CREATE TABLE public.subscription_alarms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  subscription_id uuid,
  alarm_type text NOT NULL,
  alarm_day integer,
  alarm_time time without time zone,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT subscription_alarms_pkey PRIMARY KEY (id),
  CONSTRAINT subscription_alarms_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT subscription_alarms_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscriptions(id)
);
```

#### ì£¼ìš” í•„ë“œ ì„¤ëª…

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
|--------|------|------|----------|
| `id` | uuid | ê³ ìœ  ì‹ë³„ì | PRIMARY KEY |
| `user_id` | uuid | ì‚¬ìš©ì ID | FOREIGN KEY |
| `subscription_id` | uuid | êµ¬ë… ID | FOREIGN KEY |
| `alarm_type` | text | ì•Œë¦¼ íƒ€ì… | NOT NULL |
| `alarm_day` | integer | ì•Œë¦¼ì¼ | - |
| `alarm_time` | time | ì•Œë¦¼ ì‹œê°„ | - |
| `is_active` | boolean | í™œì„±í™” ì—¬ë¶€ | DEFAULT true |
| `created_at` | timestamp | ìƒì„± ì‹œê°„ | DEFAULT now() |

---

### 4. kv_store_7a0e61a7 (í‚¤-ê°’ ì €ì¥ì†Œ)

ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ë° ìºì‹œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.

```sql
CREATE TABLE public.kv_store_7a0e61a7 (
  key text NOT NULL,
  value jsonb NOT NULL,
  CONSTRAINT kv_store_7a0e61a7_pkey PRIMARY KEY (key)
);
```

#### ì£¼ìš” í•„ë“œ ì„¤ëª…

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
|--------|------|------|----------|
| `key` | text | í‚¤ | PRIMARY KEY |
| `value` | jsonb | ê°’ (JSON) | NOT NULL |

---

## ğŸ”’ ë³´ì•ˆ ì •ì±… (RLS)

ëª¨ë“  í…Œì´ë¸”ì— Row Level Securityê°€ ì ìš©ë˜ì–´ ì‚¬ìš©ìë³„ ë°ì´í„° ì™„ì „ ë¶„ë¦¬ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.

### RLS ì •ì±… ì˜ˆì‹œ

```sql
-- subscriptions í…Œì´ë¸” RLS
ALTER TABLE public.subscriptions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own subscriptions" ON public.subscriptions
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own subscriptions" ON public.subscriptions
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own subscriptions" ON public.subscriptions
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own subscriptions" ON public.subscriptions
  FOR DELETE USING (auth.uid() = user_id);
```

---

## ğŸ“Š ì¸ë±ìŠ¤ ë° ì„±ëŠ¥ ìµœì í™”

### ê¶Œì¥ ì¸ë±ìŠ¤

```sql
-- subscriptions í…Œì´ë¸” ì¸ë±ìŠ¤
CREATE INDEX idx_subscriptions_user_id ON public.subscriptions(user_id);
CREATE INDEX idx_subscriptions_status ON public.subscriptions(status);
CREATE INDEX idx_subscriptions_payment_day ON public.subscriptions(payment_day);
CREATE INDEX idx_subscriptions_created_at ON public.subscriptions(created_at);

-- subscription_alarms í…Œì´ë¸” ì¸ë±ìŠ¤
CREATE INDEX idx_subscription_alarms_user_id ON public.subscription_alarms(user_id);
CREATE INDEX idx_subscription_alarms_subscription_id ON public.subscription_alarms(subscription_id);
CREATE INDEX idx_subscription_alarms_is_active ON public.subscription_alarms(is_active);
```

---

## ğŸ”„ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

### ì´ˆê¸° ë°ì´í„° ì‚½ì…

```sql
-- ê¸°ë³¸ í™˜ìœ¨ ì„¤ì • (ìƒˆ ì‚¬ìš©ììš©)
INSERT INTO public.exchange_rates (user_id, usd_krw)
SELECT id, 1300
FROM auth.users
WHERE id NOT IN (SELECT user_id FROM public.exchange_rates);
```

---

## ğŸ“‹ ë°ì´í„° íƒ€ì… ë§¤í•‘

### TypeScript ì¸í„°í˜ì´ìŠ¤

```typescript
interface Subscription {
  id: string;
  user_id: string;
  service_name: string;
  service_url?: string;
  service_image_url?: string;
  category?: string[];
  status: 'active' | 'paused' | 'canceled';
  amount: number;
  currency: 'KRW' | 'USD';
  payment_cycle: 'monthly' | 'yearly' | 'once';
  payment_day?: number;
  payment_method?: string;
  start_date?: string;
  end_date?: string;
  auto_renewal: boolean;
  alarm_days?: number[];
  tier?: string;
  benefits?: string;
  tags?: string[];
  memo?: string;
  created_at: string;
  updated_at: string;
}

interface ExchangeRate {
  user_id: string;
  usd_krw: number;
  updated_at: string;
}

interface SubscriptionAlarm {
  id: string;
  user_id: string;
  subscription_id: string;
  alarm_type: string;
  alarm_day?: number;
  alarm_time?: string;
  is_active: boolean;
  created_at: string;
}
```

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### ì™„ë£Œëœ ì‘ì—…
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„
- âœ… í…Œì´ë¸” ìƒì„±
- âœ… RLS ì •ì±… ì„¤ì •
- âœ… ê¸°ë³¸ ì¸ë±ìŠ¤ ìƒì„±

### ì§„í–‰ ì˜ˆì • ì‘ì—…
- [ ] ë°ì´í„° ê²€ì¦ í•¨ìˆ˜ ìƒì„±
- [ ] íŠ¸ë¦¬ê±° í•¨ìˆ˜ êµ¬í˜„ (updated_at ìë™ ì—…ë°ì´íŠ¸)
- [ ] ë°±ì—… ì •ì±… ì„¤ì •
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì„¤ì •

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025ë…„ 1ì›”  
**ë²„ì „**: 1.0.0  
**ìƒíƒœ**: âœ… ì™„ë£Œ 